# ERD와 정규화 과정
> ERD란 (Entity Relationshop Diagram) DB 구축 시 기반이 되는 뼈대 역할을 하며, 릴레이션 간의 관계를 정의한 것이다.

## 4.2.1 ERD의 중요성
- ERD는 시스템의 요구 사항을 기반으로 작성되며 ERD를 기반으로 데이터베이스를 구축한다. 
- 관계형 구조의 데이터를 구성할때는 용이하나, 비정형 데이터를 표현하기는 어렵다.

## 4.2.3 정규화 과정
- 정규화 과정은 릴레이션 간의 종속관계를 맺어주는 과정으로, <br>
잘못된 종속 관께로 인한 데이터베이스 이상현상을 해결하거나 저장 공간을 효율적으로 사용하기 위해 릴레이션을 여러 개로 분리하는 과정을 포함한다. 
- 정규화 과정은 정규형 원칙을 기반으로 정규형을 만들어가는 과정이며, 정규화의 정도를 정규형(NF, Normal Form)으로 표현합니다. 

> ### 정규형 원칙
> - 같은 의미를 표현하는 릴레이션이더라도 더 좋은 구조로 만들고, 자료의 중복성을 감소시키고, <br>
독립적인 관계는 별개의 릴레이션으로 표현하며 각각의 릴레이션은 독립적인 표현이 가능해야 한다.

### 제1 정규형
- 릴레이션의 모든 도메인이 분해될 수 없는 원자 값(atomic value)만으로 구성되어야 한다.
- 릴레이션의 속성 값 중 한 개의 기본 키에 2개 이상의 값을 가지는 반복 집합이 있어서는 안된다.
- 반복 집합이 있는 경우 제거한다.

>
>#### 제1정규형 적용 전 DB 예시
>|유저번호|유저ID|수강명|성취도|
>|--|--|--|--|
>|1|홍철|{C++코딩테스트, 프런트특강}|{90%, 10%}|
>|2|범석|{코드포스특강, DS특강}|{7%, 8%}|
>
>#### 제1정규형 적용 후 DB 예시
>|유저번호|유저ID|수강명|성취도|
>|--|--|--|--|
>|1|홍철|C++코딩테스트|90%|
>|2|홍철|프런트특강|10%|
>|3|범석|코드포스특강|7%|
>|4|범석|DS특강|8%|

### 제2 정규형
- 릴레이션이 제1정규형이며, 부분 함수의 종속성을 제거한 형태
**부분 함수의 종속성 제거** : 기본키가 아닌 모든 속성이 기본키에 완전 함수 종속적인 것이다.

>#### 제2정규형 적용 전 DB 예시
>|유저번호|유저ID|수강명|성취도|
>|--|--|--|--|
>|1|홍철|C++코딩테스트|90%|
>|2|홍철|프런트특강|10%|
>|3|범석|코드포스특강|7%|
>|4|범석|DS특강|8%|
>
>#### 제2정규형 적용 후 DB 예시
> **유저 테이블**
>|유저번호|유저ID|
>|--|--|
>|1|홍철|
>|2|범석|
>
> **유저_수강 테이블**
>|유저ID|수강명|성취도|
>|--|--|--|
>|홍철|C++코딩테스트|90%|
>|홍철|프런트특강|10%|
>|범석|코드포스특강|7%|
>|범석|DS특강|8%|

### 제3정규형
- 제2정규형이고 기본키가 아닌 모든 속성이 이행적 함수 종속(transitive FD)를 만족하지 않는 상태를 의미한다.

### 이행적 함수 종속
- 이행적 함수 종속이란 A -> B 와 B -> C 가 존재하면 논리적으로 A -> C 가 성립되는데, <br>
이때 집합 C가 집합 A에 이행적으로 함수 종속이 되었다고 합니다. 

### 보이스/코드 정규형
- 보이스/코드 정규형(BCNF)는 제3정규형이고, 결정자가 후보키가 아닌 함수 종속 관계를 제거하여 릴레이션의 함수 종속 관계에서 모든 결정자가 후보키인 상태를 의미한다.

**결정자** : 함수 종속 관계에서 특정 종속자(dependent)를 결정짓는 요소, `X`->`Y`일 때 X는 결정자, Y는 종속자이다.

> 정규형 과정을 거쳐 테이블을 나눈다고 해서 성능이 100% 좋아지는 것은 아니다. 
> <br> 테이블을 나누게 되면 어떠한 쿼리는 조인을 해야 하는 경우도 발생하므로 오히려 성능저하가 발생할 수도 있다. 
> <br> 정규화의 범위는 서비스의 규모와 요구조건에 따라 정규화 또는 비정규화 과정을 진행해야 한다.

# 트랜잭션과 무결성

## 4.3.1 트랜잭션
- 트랜잭션은 데이터베이스에서 하나의 논리적 기능을 수행하기 위한 작업의 단위를 의미한다.
- 데이터베이스에 접근하는 방법은 쿼리이므로, 여러 개의 쿼리들을 하나로 묶는 단위를 말한다.
- ACID 특징 :원자성, 일관성, 독립성, 지속성

### 원자성(atomicity)
- 트랜잭션과 관련된 일이 모두 수행되었거나, 되지 않았거나를 보장하는 특징
ex. 트랜잭션 커밋 후 문제가 발생하여 롤백하는 경우 그 이후에 모두 수행되지 않음을 보장
- 트랜잭션 단위로 여러 로직들을 묶을 때 외부 API를 호출하는 것이 있으면 안된다.
(만약 있다면 롤백이 일어났을 때 어떻게 해야 할 것인지에 대한 해결방법이 있어야하고 트랜잭션 전파를 신경 써서 관리해야 함)

#### 커밋과 롤백
**커밋**
- 커밋은 여러 쿼리가 성공적으로 처리되었다고 확정하는 명령어
- 트랜잭션 단위로 수행되며 변경된 내용이 모두 영구적으로 저장되는 것을 의미한다.
~~(커밋이 수행되었다 = 하나의 트랜잭션이 성공적으로 수행되었다)~~
**`쿼리` > `update` > `insert` > `delete` > `DB`** : update, insert, delete 쿼리가 하나의 트랜잭션 단위로 수행되고 이후에 데이터베이스에 영구 저장된다.
<br>
**롤백**
- 트랜잭션으로 처리한 하나의 묶음 과정을 일어나기 전으로 되돌리는 일을 말합니다.

### 일관성(consistency)
- `허용된 방식`으로만 데이터를 변경해야 하는 것을 일관성이라고 표현한다.
- 데이터베이스에 기록된 모든 데이터는 여러 가지 조건, 규칙에 따라 유효함을 가져야 한다.

### 독립성/격리성(isolation)
- 트랜잭션 수행 시 서로 끼어들지 못하는 것을 의미한다.
- 복수의 병렬 트랜잭션은 서로 격리되어 순차적으로 실행되는 것처럼 작동되어야 한다.
- 데이터베이스는 다수의 사용자가 같은 데이터에 접근할 수 있어야 한다.

### 지속성(durability)
- 성공적으로 수행된 트랜잭션은 영원히 반영되어야 하는 것을 의미한다.
- DB에 시스템 장애가 발생해도 원래 상태로 복구하는 회복 기능이 있어야 한다는 의미이며, 통상적으로 DB는 체크섬, 저널링, 롤백 등의 기능을 제공한다.

>**체크섬** : 중복 검사의 한 형태로, 오류 정정을 통해 송신된 자료의 무결성을 보호하는 단순한 방법
>**저널링** : 파일 시스템 또는 데이터베이스 시스템에 변경 사항을 반영하기 전에 로깅하는 것, 트랜잭션 등 변경 사항에 대한 로그를 남기는 것


## 4.3.2 무결성
- 무결성이란 데이터의 정확성, 일관성, 유효성을 유지하는 것을 말하며 무결성이 유지되어야 데이터베이스에 저장된 데이터 값과 그 값에 해당하는 현실 세계의 실제 값이 일치하는지에 대한 신뢰가 생긴다/

#### 무결성 종류
|이름|설명|
|개체 무결성|기본키로 선택된 필드는 빈 값을 허용하지 않습니다.|
|참조 무결성|서로 참조 관계에 있는 두 테이블의 데이터는 항상 일관된 값을 유지해야 한다.|
|고유 무결성|특정 속성에 대해 고유한 값을 가지도록 조건이 주어진 경우 그 속성 값은 모두 고유한 값을 가진다.|
|NULL 무결성|특정 속성 값에 NULL이 올 수 없다는 조건이 주어진 경우 그 속성 값은 NULL이 될 수 없다는 제약 조건이다.|
